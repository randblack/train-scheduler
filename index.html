<html>
  <head>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script src="https://www.gstatic.com/firebasejs/5.8.6/firebase.js"></script>
    <script src="./assets/javascript/luxon.js"></script>
    <script src="./assets/javascript/moment.min.js"></script>
    <script>
    // Initialize Firebase
    var config = {
      apiKey: "AIzaSyAswgmZ536I0ZtdFRx9OEhdhjft-ZFOyjM",
      authDomain: "employee-data-e4941.firebaseapp.com",
      databaseURL: "https://employee-data-e4941.firebaseio.com",
      projectId: "employee-data-e4941",
      storageBucket: "",
      messagingSenderId: "811195306784"
    };
    firebase.initializeApp(config);
      firebase.database.enableLogging(function(message) {
      //console.log("[FIREBASE]", message);
      });
      let database = firebase.database();
// { myKey: "this is the value", myKey2: "value", myKey3: "value"} myObject.myKey [{myKey: "value"}, {myKey: "value"}]
database.ref().on("value", function(snapshot) {
  console.log(snapshot.val())
  console.log(Object.keys(snapshot) + " keys")
  newTrain = Object.keys(snapshot.val());
  for (i = 0; i < newTrain.length; i++) {
    var tableRow = $('<tr>');
    var trainName = $('<th>').html(snapshot.val()[newTrain[i]].newTrain.trainName);
    trainName.attr('scope', 'row')
    var destination = $('<td>').html(snapshot.val()[newTrain[i]].newTrain.destination);
    var frequency = $('<td>').html(snapshot.val()[newTrain[i]].newTrain.frequency);
    var nextArrivalTime = $('<td>').html(snapshot.val()[newTrain[i]].newTrain.nextArrivalTime);
    var minutesAway = $('<td>').html(snapshot.val()[newTrain[i]].newTrain.minutesAway);
    tableRow.append(trainName);
    tableRow.append(destination);
    tableRow.append(frequency);
    tableRow.append(nextArrivalTime);
    tableRow.append(minutesAway);
    $('#employeeTable').append(tableRow);
  }

});

function setup () {
  $("#submitTrain").on("click", function(){
    let trainName = $('#trainName').val();
    let destination = $('#destination').val();;
    let frequency = $('#frequency').val();;
    let firstTrainTime = $('#firstTrainTime').val();;
    firstTimeConverted = moment(firstTrainTime, "hh:mm").subtract(1, "years");
    currentTime = moment();
    timeDifference = moment().diff(moment(firstTimeConverted), "minutes");
    remainder = timeDifference % frequency;
    minutesAway = frequency - remainder;
    console.log(minutesAway);
    nextArrival = moment().add(minutesAway, "minutes");
    nextArrivalTime = moment(nextArrival).format("hh:mm");
    console.log(nextArrivalTime);
    let newTrain = {
        trainName: trainName,
        destination: destination,
        frequency: frequency,
        nextArrivalTime: nextArrivalTime,
        minutesAway: minutesAway
    }
    console.log(newTrain);
    database.ref().push({
      newTrain
    });
  });
}
    </script>
    <style>
      #formContent {
        padding: 25px;
        border: solid 1px rgb(218, 218, 218);
        width: 90%;
        margin: auto;
        border-radius: 5px;
        margin-bottom: 25px;
      }
      #tableContent {
        border-radius: 5px;
        border: solid 1px rgb(218, 218, 218);
        margin-bottom: 25px;
      }
      .jumbotron {
        text-align: center;
        margin-bottom: 25px;
        margin-top: 25px;
      }
    </style>
  </head>
  <body onLoad="setup();">
    <div class="container">
          <div class="jumbotron bg-dark text-white">
            <h1>Train Scheduler</h1> 
            <p>choo choo my dudes</p> 
          </div>
        </div>
    <div class="container">
        <table class="table">
            <thead class="thead-dark">
              <tr>
                <th scope="col">Train Name</th>
                <th scope="col">Destination</th>
                <th scope="col">Frequency (min)</th>
                <th scope="col">Next Arrival</th>
                <th scope="col">Minutes Away</th>
              </tr>
            </thead>
            <tbody id="employeeTable">
            </tbody>
          </table>
    </div>
    <div id="formContent" class="container">
      <form>
        <div class="form-group">
          <label for="exampleFormControlInput1">Train Name</label>
          <input type="name" class="form-control" id="trainName" placeholder="Name of Train">
        </div>
        <div class="form-group">
          <label for="exampleFormControlInput1">Destination</label>
          <input type="role" class="form-control" id="destination" placeholder="Los Angeles">
        </div>
          <div class="form-group">
            <label for="exampleFormControlInput1">First Train Time (hh:mm)</label>
            <input type="text" class="form-control" id="firstTrainTime" placeholder="12:00">
          </div>
          <div class="form-group">
            <label for="exampleFormControlInput1">Frequency</label>
            <input type="rate" class="form-control" id="frequency" placeholder="15">
          </div>
          <div class="form-group"> <!-- Submit button !-->
            <button id="submitTrain" class="btn btn-primary " name="submit" type="submit">Submit</button>
          </div>
      </form>
    </div>
  </body>
</html>